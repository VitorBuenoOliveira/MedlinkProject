<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Cadastro de Clientes - Ambul√¢ncia</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav>
        <img src="medilink_logo.png" alt="MediLink Logo" class="logo" />
        <a href="/dashboard.html">Dashboard</a>
        <a href="/client_management.html">Clientes</a>
        <a href="/motorista_registration.html">Motoristas</a>
        <a href="/ambulancia_registration.html">Ambul√¢ncias</a>
        <a href="/hospital_registration.html">Hospitais</a>
        <a href="/usuario_registration.html">Usu√°rios</a>
        <a href="/scheduling.html">Agendamento</a>
        <a href="/reports.html">Relat√≥rios</a>
    </nav>

    <h1>Sistema de Ambul√¢ncia üöë</h1>

    <h2>Cadastrar Cliente</h2>
    <form id="formCliente">
        Nome: <input type="text" name="nome" required /><br />
        Cart√£o: <input type="text" name="cartao" /><br />
        Tipo: <input type="text" name="tipo" /><br />
        Telefone: <input type="text" name="telefone" /><br />
        Destino: <input type="text" name="destino" /><br />
        <button type="submit">Cadastrar</button>
    </form>

    <h2>Lista de Clientes</h2>
    <table id="tabelaClientes" border="1">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Destino</th>
                <th>Status</th>
                <th>A√ß√£o</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>üìä Estat√≠sticas</h2>
    <canvas id="grafico" width="400" height="200"></canvas>

    <script>
        async function carregarClientes() {
            const res = await fetch('/clientes');
            const clientes = await res.json();
            const tbody = document.querySelector('#tabelaClientes tbody');
            tbody.innerHTML = '';
            clientes.forEach((c) => {
                tbody.innerHTML += `
                <tr>
                    <td>${c.nome}</td>
                    <td>${c.destino}</td>
                    <td>${c.atendido ? '‚úÖ Atendido' : '‚è≥ Pendente'}</td>
                    <td><button onclick="atender(${c.id})">Atender</button></td>
                </tr>
            `;
            });
        }

        async function atender(id) {
            await fetch('/clientes/' + id + '/atender', { method: 'PUT' });
            carregarClientes();
            carregarGrafico();
        }

        document.getElementById('formCliente').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = new FormData(e.target);
            const data = {};
            form.forEach((value, key) => (data[key] = value));
            await fetch('/clientes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data),
            });
            e.target.reset();
            carregarClientes();
            carregarGrafico();
        });

        async function carregarGrafico() {
            const res = await fetch('/clientes/estatisticas');
            const stats = await res.json();

            new Chart(document.getElementById('grafico'), {
                type: 'line',
                data: {
                    labels: Object.keys(stats),
                    datasets: [
                        {
                            label: 'Clientes',
                            data: Object.values(stats),
                            fill: true,
                            backgroundColor: 'rgba(54, 162, 235, 0.3)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                        },
                    ],
                },
            });
        }

        carregarClientes();
        carregarGrafico();
    </script>
</body>
</html>
