<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento - Sistema de Transporte</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
        .agenda-item {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .agenda-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.3);
        }
        .status-pending {
            background: linear-gradient(135deg, rgba(255, 216, 155, 0.3) 0%, rgba(255, 179, 71, 0.3) 100%);
            border-left: 4px solid #ffb347;
        }
        .status-confirmed {
            background: linear-gradient(135deg, rgba(132, 250, 176, 0.3) 0%, rgba(143, 211, 244, 0.3) 100%);
            border-left: 4px solid #8fd3f4;
        }
        .status-completed {
            background: linear-gradient(135deg, rgba(132, 250, 176, 0.3) 0%, rgba(143, 211, 244, 0.3) 100%);
            border-left: 4px solid #84fab0;
        }
        .action-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <nav>
        <img src="medilink_logo.png" alt="MediLink Logo" class="logo" />
        <a href="/dashboard.html"><i class="fas fa-home"></i> Dashboard</a>
        <a href="/client_management.html"><i class="fas fa-users"></i> Clientes</a>
        <a href="/motorista_registration.html"><i class="fas fa-user-tie"></i> Motoristas</a>
        <a href="/ambulancia_registration.html"><i class="fas fa-ambulance"></i> Ambul√¢ncias</a>
        <a href="/hospital_registration.html"><i class="fas fa-hospital"></i> Hospitais</a>
        <a href="/usuario_registration.html"><i class="fas fa-user-plus"></i> Usu√°rios</a>
        <a href="/scheduling.html"><i class="fas fa-calendar-alt"></i> Agendamento</a>
        <a href="/reports.html"><i class="fas fa-chart-bar"></i> Relat√≥rios</a>
    </nav>

    <div class="container">
        <h1>Agendamento de Transportes üìÖ</h1>

        <div class="action-buttons" style="margin-bottom: 20px;">
            <button onclick="gerarAgenda()"><i class="fas fa-calendar-plus"></i> Gerar Agenda do Dia</button>
            <button onclick="carregarAgenda()"><i class="fas fa-sync"></i> Atualizar Agenda</button>
        </div>

        <h2><i class="fas fa-clipboard-list"></i> Agenda do Dia</h2>
        <div id="agendaContainer">
            <p style="text-align: center;"><i class="fas fa-spinner fa-spin"></i> Carregando agenda...</p>
        </div>
    </div>

    <script>
        async function carregarAgenda() {
            try {
                // For now, load clients as agenda items
                const res = await fetch('/clientes');
                const clientes = await res.json();
                const container = document.getElementById('agendaContainer');
                container.innerHTML = "";
                
                if (clientes.length === 0) {
                    container.innerHTML = "<p style='text-align: center;'><i class='fas fa-inbox'></i> Nenhum transporte agendado para hoje.</p>";
                    return;
                }

                clientes.forEach(c => {
                    const statusClass = c.atendido ? 'status-completed' : 'status-pending';
                    const statusIcon = c.atendido ? 'fas fa-check-circle' : 'fas fa-clock';
                    container.innerHTML += `
                        <div class="agenda-item ${statusClass}">
                            <h3><i class="fas fa-user"></i> ${c.nome}</h3>
                            <p><i class="fas fa-map-marker-alt"></i> <strong>Destino:</strong> ${c.destino}</p>
                            <p><i class="fas fa-phone"></i> <strong>Telefone:</strong> ${c.telefone}</p>
                            <p><i class="${statusIcon}"></i> <strong>Status:</strong> ${c.atendido ? 'Atendido' : 'Pendente'}</p>
                            ${!c.atendido ? `<button onclick="marcarComoAtendido(${c.id})"><i class="fas fa-check"></i> Marcar como Atendido</button>` : ''}
                        </div>
                    `;
                });
            } catch (error) {
                console.error('Erro ao carregar agenda:', error);
                document.getElementById('agendaContainer').innerHTML = 
                    "<p style='text-align: center; color: #e53e3e;'><i class='fas fa-exclamation-triangle'></i> Erro ao carregar agenda.</p>";
            }
        }

        async function marcarComoAtendido(id) {
            try {
                await fetch('/clientes/' + id + '/atender', { method: 'PUT' });
                carregarAgenda();
            } catch (error) {
                console.error('Erro ao marcar como atendido:', error);
                alert('Erro ao marcar como atendido');
            }
        }

        function gerarAgenda() {
            alert('Funcionalidade de gera√ß√£o autom√°tica de agenda a ser implementada no backend.');
        }

        // Load agenda on page load
        carregarAgenda();
    </script>
</body>
</html>
