<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geolocaliza√ß√£o - Ambul√¢ncias</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="has-sidebar">
    <!-- Top Header Bar -->
    <div class="top-header">
        <div class="header-left">
            <button class="sidebar-toggle-btn" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <a href="/home.html" class="home-btn">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
        </div>
        <div class="header-right">
            <div class="user-header-profile">
                <div class="user-avatar-small">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info-small">
                    <span class="user-name">Admin User</span>
                    <span class="user-email">admin@medilink.com</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar (injected by JavaScript) -->
    <div id="sidebar-container"></div>

    <!-- Main Content -->
    <main class="main-content">

    

    <div class="container">
        <h1>Geolocaliza√ß√£o das Ambul√¢ncias üöë</h1>

        <div id="map"></div>
    </div>

    <script>
        // Posi√ß√£o do usu√°rio (simulada)
        const userPosition = { lat: -23.5505, lng: -46.6333 };
        
        // Dados fict√≠cios de ambul√¢ncias pr√≥ximas para simula√ß√£o
        const ambulancias = [
            { 
                placa: 'ABC-1234', 
                latitude: -23.5510, 
                longitude: -46.6338, 
                status: 'Dispon√≠vel',
                motorista: 'Jo√£o Silva',
                distancia: '0.8 km',
                tempo: '3 min'
            },
            { 
                placa: 'DEF-5678', 
                latitude: -23.5515, 
                longitude: -46.6343, 
                status: 'Dispon√≠vel',
                motorista: 'Maria Santos',
                distancia: '1.2 km',
                tempo: '5 min'
            },
            { 
                placa: 'GHI-9012', 
                latitude: -23.5502, 
                longitude: -46.6328, 
                status: 'Dispon√≠vel',
                motorista: 'Carlos Oliveira',
                distancia: '0.5 km',
                tempo: '2 min'
            },
            { 
                placa: 'JKL-3456', 
                latitude: -23.5520, 
                longitude: -46.6348, 
                status: 'Em tr√¢nsito',
                motorista: 'Ana Costa',
                distancia: '1.5 km',
                tempo: '6 min'
            },
            { 
                placa: 'MNO-7890', 
                latitude: -23.5498, 
                longitude: -46.6320, 
                status: 'Dispon√≠vel',
                motorista: 'Pedro Souza',
                distancia: '0.9 km',
                tempo: '4 min'
            }
        ];

        function initMap() {
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 14,
                center: userPosition,
                styles: [
                    {
                        featureType: 'poi',
                        elementType: 'labels',
                        stylers: [{ visibility: 'off' }]
                    }
                ]
            });

            // Marcador do usu√°rio (sua posi√ß√£o)
            const userMarker = new google.maps.Marker({
                position: userPosition,
                map: map,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 12,
                    fillColor: '#667eea',
                    fillOpacity: 1,
                    strokeColor: '#ffffff',
                    strokeWeight: 3
                },
                title: 'Voc√™ est√° aqui',
                zIndex: 1000
            });

            // InfoWindow para o usu√°rio
            const userInfoWindow = new google.maps.InfoWindow({
                content: `<div style="padding: 10px;"><strong>üìç Voc√™ est√° aqui</strong></div>`
            });

            userMarker.addListener('click', () => {
                userInfoWindow.open(map, userMarker);
            });

            // Marcadores das ambul√¢ncias pr√≥ximas
            const markers = ambulancias.map(ambulancia => {
                // √çcone personalizado baseado no status
                const iconColor = ambulancia.status === 'Dispon√≠vel' ? '#10b981' : '#f59e0b';
                
                const marker = new google.maps.Marker({
                    position: { lat: ambulancia.latitude, lng: ambulancia.longitude },
                    map: map,
                    icon: {
                        url: `data:image/svg+xml;utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="20">üöë</text></svg>`,
                        scaledSize: new google.maps.Size(40, 40)
                    },
                    title: `Ambul√¢ncia ${ambulancia.placa}`,
                    animation: google.maps.Animation.DROP
                });

                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="padding: 15px; min-width: 220px;">
                            <h3 style="margin: 0 0 10px 0; color: #667eea; font-size: 1.1rem;">üöë ${ambulancia.placa}</h3>
                            <p style="margin: 5px 0;"><strong>Status:</strong> <span style="color: ${iconColor}">${ambulancia.status}</span></p>
                            <p style="margin: 5px 0;"><strong>Motorista:</strong> ${ambulancia.motorista}</p>
                            <p style="margin: 5px 0;"><strong>Dist√¢ncia:</strong> ${ambulancia.distancia}</p>
                            <p style="margin: 5px 0;"><strong>Tempo estimado:</strong> ${ambulancia.tempo}</p>
                            ${ambulancia.status === 'Dispon√≠vel' ? '<button onclick="solicitarAmbulancia(\'' + ambulancia.placa + '\')" style="margin-top: 10px; padding: 8px 16px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Solicitar Esta Ambul√¢ncia</button>' : ''}
                        </div>
                    `
                });

                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });

                return { marker, ambulancia };
            });

            // Simula√ß√£o de movimento das ambul√¢ncias
            setInterval(() => {
                markers.forEach(({ marker, ambulancia }) => {
                    // Movimento aleat√≥rio pequeno para simular tr√¢nsito
                    ambulancia.latitude += (Math.random() - 0.5) * 0.0005;
                    ambulancia.longitude += (Math.random() - 0.5) * 0.0005;
                    
                    marker.setPosition(new google.maps.LatLng(ambulancia.latitude, ambulancia.longitude));
                });
            }, 3000);
        }

        // Fun√ß√£o para solicitar ambul√¢ncia
        function solicitarAmbulancia(placa) {
            const ambulancia = ambulancias.find(a => a.placa === placa);
            if (ambulancia) {
                if (confirm(`Deseja solicitar a ambul√¢ncia ${placa}?\n\nMotorista: ${ambulancia.motorista}\nTempo estimado: ${ambulancia.tempo}\nDist√¢ncia: ${ambulancia.distancia}`)) {
                    alert(`Solicita√ß√£o enviada! A ambul√¢ncia ${placa} foi acionada e est√° a caminho.\n\nVoc√™ receber√° atualiza√ß√µes em tempo real.`);
                    // Aqui voc√™ pode redirecionar para a p√°gina de tracking
                    // window.location.href = 'cliente_track.html?ambulancia=' + placa;
                }
            }
        }

        // Inicializa o mapa
        initMap();
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAIz6iI0blYnCpoGhjstXvYbxdVdyHRWpo&callback=initMap"></script>
    </main>

    <script src="sidebar.js"></script>
    <script>
        // Inject sidebar
        document.getElementById('sidebar-container').innerHTML = createSidebar('geolocation');
        
        // Apply saved theme
        const theme = localStorage.getItem('theme') || 'light';
        if (theme === 'dark') {
            document.body.classList.add('dark-theme');
        }
        
        // Apply accessibility settings
        const highContrast = localStorage.getItem('highContrast') === 'true';
        const largeText = localStorage.getItem('largeText') === 'true';
        
        if (highContrast) {
            document.body.classList.add('high-contrast');
        }
        if (largeText) {
            document.body.classList.add('large-text');
        }
    </script>
</body>
</html>
